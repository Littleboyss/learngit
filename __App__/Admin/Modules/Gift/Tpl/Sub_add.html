<include file="Public:header" />
<style type="text/css">
input.iptxt{
    width: 350px;
}
.tRight{
    text-align: right;
}
select optgroup {
    color: #2288cc;
}
select option {
    color: #2288cc;
}
input.sm{
    width:100px;
}
</style>
<div class="subnav">
    <div class="content-menu ib-a blue line-x">
    <a href='javascript:;' class="on"><em>修改分类</em></a>
    <span>|</span>
    <a href="{:U('index')}"><em>返回列表</em></a>
    </div>
</div>
<div class="pad_10">
    <div class="table-list">
        <form method="post" id="form1" action="{:U('add')}">
                <table width='98%' border='0' cellpadding='0' cellspacing='0'
                       align="center" class="rtable">
                       <input type="hidden" name="id" value="{$data.id}">
                    <tr>
                        <td class="tRight">所属分类：</td>
                        <td class="tLeft" colspan="3">
                            <select name="pid" id="sub_id">
                            <option value="0">顶级分类</option>
                            <?php
                            foreach ($projects as $k => $v) {
                                echo '<option value="'.$v['id'].'"';
                                if($data['pid'] == $v['id']){
                                  echo 'selected';
                                }   
                                echo '>'.str_repeat('&nbsp;',$v['level']*4).$v['name'].'</option>';
                            }
                    ?>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td class="tRight">名称：</td>
                        <td class="tLeft" colspan="3">
                            <input type="text" name="catename" value="{$data.name}" class="huge iptxt" />
                        </td>
                    </tr>

                    <tr id='attr' <?php 
                        if (!isset($attribute)) {
                           echo 'class="display"'; 
                        }
                    ?>
                    >
                        <td class="tRight">该分类对应的属性名称：</td>
                        <td class="tLeft" colspan="3">
                            <input type="text" name="attr_name" value="<?php 
                            echo implode(',',$attribute);
                            ?>" class="huge iptxt" />(多个属性名称以逗号分隔)
                        </td>
                    </tr>
                    <tr>
                        <td class="center"></td>
                        <td class="center" colspan="3">
                            <input type="submit" value="保 存" />
                        </td>
                    </tr>
                </table>
            </form>
            <br /><br /><br />
    </div>
</div>
<script type="text/javascript">
function show_attr(){
    var sub_id = $('#sub_id option:selected').val()
    // 判断是否是实物分类
    $.ajax({
        url: '/index.php?g=Gift&m=Sub&a=check_sub',
        type: 'post',
        data: {
            'sub_id':sub_id
        },
        cache: false,
        dataType: 'json', // 期待后台返回的数据类型 json
        success:function(json){
            if (json.status == 1) {
                if (json.url ==4) {
                    $('#attr').show();
                }else{
                    $('#attr').hide();
                }
            }
            
        },
    })
}
$("#sub_id").change(function(){ 
    show_attr();
})
show_attr();
</script>
</body></html>
<include file="Public:header" />

<link rel="stylesheet" type="text/css" href="/js/calendar/jscal2.css"/>
<link rel="stylesheet" type="text/css" href="/js/calendar/border-radius.css"/>
<link rel="stylesheet" type="text/css" href="/js/calendar/win2k.css"/>
<script type="text/javascript" src="/js/calendar/calendar.js"></script>
<script type="text/javascript" src="/js/calendar/lang/en.js"></script>

<style type="text/css">
select optgroup {
    color: #2288cc;
}
select option {
    color: #2288cc;
}
input.iptxt{
    width: 350px;
}
input.sm{
    width: 100px;
}
.sbtn{
    height: 35px;
    line-height: 35px;
    cursor: pointer;
    display: inline-block;
}
.sbtn:hover{
    color: blue;
}
.tRight{
    text-align: right;
}
.tarea{
    width:345px;
    height: 106px;
}
</style>
<script>
    config.filterMode = true;
    config.width= '700px';
    KindEditor.ready(function(K) {
        var editor = K.create('#background',config);
    });
function upload_img(input,out){
    KindEditor.ready(function(K) {
        var editor =  K.editor(config);
        var uploadbutton = K.uploadbutton({
            button : K('#'+input)[0],
            fieldName : 'imgFile',
            url :  './index.php?m=Index&a=upload',
            afterUpload : function(data) {
                if (data.error === 0) {
                    var url = K.formatUrl(data.url, 'absolute');
                    K('#'+out).val(url);
                } else {
                    alert(data.message);
                }
            },
            afterError : function(str) {
                alert('自定义错误信息: ' + str);
            }
        });
        uploadbutton.fileBox.change(function(e) {
            uploadbutton.submit();
        });
    });
}
upload_img('wqico','ico'); 
upload_img('wqico1','ico1'); 
upload_img('wqico2','ico2'); 
upload_img('wqico3','ico3'); 
upload_img('wqico4','ico4'); 
upload_img('wqico5','ico5'); 
</script>
<div class="subnav">
    <div class="content-menu ib-a blue line-x">
        <a href='javascript:;' class="on"><em>添加商品</em></a>
        <span>|</span>
        <a href="{:U('index')}"><em>返回列表</em></a>
    </div>
</div>
<div class="pad_10">
    <div class="table-list">
        <form method="post" id="form1" action="{:U('add')}">
                <table width='98%' border='0' cellpadding='0' cellspacing='0'
                       align="center" class="rtable">
                    <tr>
                        <td class="tRight">是否上架：</td>
                        <td class="tLeft" colspan="3">
                            <input type="radio" name="state" value="1" checked="checked" />上架　
                            <input type="radio" name="state" value="2" />下架　
                        </td>
                    </tr>
                    <tr>
                        <td class="tRight">是否为热门推荐：</td>
                        <td class="tLeft" colspan="3">
                            <input type="radio" name="hot_sort" value="1" checked="checked" />是　
                            <input type="radio" name="hot_sort" value="0" />否　
                        </td>
                    </tr>
                    <tr>
                        <td class="tRight">分类：</td>
                        <td class="tLeft" colspan="3">
                            <select name="shop_sub_id" id="sub_id">
                                <?php
                        foreach ($projects as $key => $value) {
                          if ($value['pid'] == 0 ) {
                            echo '<optgroup label="'.$value['name'].'">';
                            foreach ($projects as $k => $v) {
                              if ($v['pid'] == $value['id']) {
                                echo '<option value="'.$v['id'].'"';
                                if($sub_id == $v['id']){
                                  echo 'selected';
                                }
                                echo '>'.$v['name'].'</option>';
                              }
                            }
                            echo "</optgroup>";
                          }
                        }
                    ?>
                            </select>
                        </td>
                    </tr>
                    <tbody id="list" >
                        
                    </tbody>
                    <tr>
                        <td class="tRight">商品名称：</td>
                        <td class="tLeft" colspan="3">
                            <input type="text" name="name" value="{$data.name}" class="huge iptxt" />
                        </td>
                    </tr>
                    <tr>
                        <td class="tRight">商品缩略图：</td>
                        <td class="tLeft" colspan="3">
                            <input type="text" class="large iptxt" id="ico" name="avatar_img" value="{$data.avatar_img}" style="margin-top: 3px"> 
                            <input type="button" id="wqico" value="上传图片">
                        </td>
                    </tr>
                    <tr class="img">
                        <td class="tRight">商品相册图片1：</td>
                        <td class="tLeft" colspan="3">
                            <input type="text" class="large iptxt" id="ico1" name="img1" value="{$data.img1}" style="margin-top: 3px"> 
                            <input type="button" id="wqico1" value="上传图片">(至少上传一张)
                        </td>
                    </tr>
                    <tr class="img">
                        <td class="tRight">商品相册图片2：</td>
                        <td class="tLeft" colspan="3">
                            <input type="text" class="large iptxt" id="ico2" name="img2" value="{$data.img2}" style="margin-top: 3px"> 
                            <input type="button" id="wqico2" value="上传图片">
                        </td>
                    </tr>
                    <tr class="img">
                        <td class="tRight">商品相册图片3：</td>
                        <td class="tLeft" colspan="3">
                            <input type="text" class="large iptxt" id="ico3" name="img3" value="{$data.img3}" style="margin-top: 3px"> 
                            <input type="button" id="wqico3" value="上传图片">
                        </td>
                    </tr>
                    <tr class="img">
                        <td class="tRight">商品相册图片4：</td>
                        <td class="tLeft" colspan="3">
                            <input type="text" class="large iptxt" id="ico4" name="img4" value="{$data.img4}" style="margin-top: 3px"> 
                            <input type="button" id="wqico4" value="上传图片">
                        </td>
                    </tr>
                    <tr class="img">
                        <td class="tRight">商品相册图片5：</td>
                        <td class="tLeft" colspan="3">
                            <input type="text" class="large iptxt" id="ico5" name="img5" value="{$data.img5}" style="margin-top: 3px"> 
                            <input type="button" id="wqico5" value="上传图片">
                        </td>
                    </tr>
                    <tr>
                        <td class="tRight">单人最大购买数量：</td>
                        <td class="tLeft" colspan="3">
                            <input type="text" name="remain_num" value="{$data.remain_num}" class="huge iptxt sm" />
                        </td>
                    </tr>
                    <tr>
                        <td class="tRight">排序号：</td>
                        <td class="tLeft" colspan="3">
                            <input type="text" name="sort" value="{$data.sort}" class="huge iptxt sm" />
                        </td>
                    </tr>
                    <tr>
                        <td class="tRight">商品发布者：</td>
                        <td class="tLeft" colspan="3">
                            <input type="text" name="author" value="{$data.author}" readonly="" class="huge iptxt sm" />
                        </td>
                    </tr>
                    <tr>
                        <td class="tRight">价格：</td>
                        <td class="tLeft" colspan="3">
                            <input type="text" name="price" value="" class="huge iptxt sm"   />
                        </td>
                    </tr>
                    <tr>
                        <td class="tRight">消耗资源类型:</td>
                        <td class="tLeft" colspan="3">
                            <select name="type">
                             <option value='2'>木头</option>
                             <option value='1'>砖石</option>
                            </select>(实物必须为木头)
                        </td>
                    </tr>
                    <tr>
                        <td class="tRight">库存：</td>
                        <td class="tLeft" colspan="3">
                            <input type="text" name="has_nums" value="{$data.has_nums}" class="huge iptxt sm" />
                        </td>
                    </tr>
                    <tr>
                        <td class="tRight">商品描述：</td>
                        <td class="tLeft" colspan="3">
                            <textarea name="intro" class="tarea"  ></textarea>（255字以内包括标点符号）
                        </td>
                    </tr>
                    <tr>
                        <td class="tRight">商品详情：</td>
                        <td class="tLeft" colspan="3">
                            <textarea name="detail" id="background"  ></textarea>
                        </td>
                    </tr>
                    <tr id="subtn">
                        <td class="center"></td>
                        <td class="center" colspan="3">
                            <input type="submit" value="保 存" />
                        </td>
                    </tr>
                </table>
            </form>
            <br /><br /><br />
    </div>
</div>
</body>
<script>

function checktype(a,b){
    $("." + a).css('display','table-row');
    $("." + b).css('display','none');
}
$("#sub_id").change(function(){	
    $('#list').html('');
    var sub_id = $('#sub_id option:selected').val()
	$.ajax({
        url: '/index.php?g=Gift&m=Exchange&a=get_attribute',
        type: 'post',
        data: {
            'sub_id':sub_id
        },
        cache: false,
        dataType: 'json', // 期待后台返回的数据类型 json
        success:function(json){
            if (json.status == 1) {
                var html ='';
                $.each(json.url,function(i,item){
                    html +="<tr>";
                    html +="<td class=\'tRight\'>"+item.attr_name+"：</td>";
                    html +="<td class=\'tLeft\' colspan=\'3\'>";
                    html +="<input type=\'text\' name=\'attr_value[]\' value=\'\' class=\'huge iptxt sm\' />";
                    html +="<input type=\'text\' hidden name=\'attr_id[]\' value=\'"+item.id+"\' class=\'huge iptxt sm\' />(请以逗号分隔)";
                    html +="</td>";
                    html +="</tr>";
                })
                $('#list').html(html);
                $('#list').show();
            }
            
        },
    })
})


</script>
</html>
